<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Doctors | HMS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        :root{ --hms-primary:#0d6efd; --hms-bg:#f5f9ff; }
        body{ background:var(--hms-bg); }
        .card{ border:0; box-shadow:0 6px 16px rgba(13,110,253,.08); }
        .form-label{ font-weight:600; }
        .required::after{ content:" *"; color:#dc3545; }
        .thumb { max-height:40px; border-radius:6px; }
    </style>
</head>
<body>
<nav class="navbar bg-white shadow-sm">
    <div class="container">
        <a class="navbar-brand text-primary" href="/"><i class="fa-solid fa-hospital me-2"></i>Hospital Management</a>
    </div>
</nav>

<div class="container my-4">
    <h2><i class="fa-solid fa-user-doctor me-2 text-primary"></i>Doctor Management</h2>

    <div th:if="${msg}" class="alert alert-success mt-3" th:text="${msg}"></div>
    <div th:if="${err}" class="alert alert-danger mt-3" th:text="${err}"></div>

    <div class="row g-4 mt-2">
        <!-- Add Doctor Form -->
        <div class="col-lg-5">
            <div class="card">
                <div class="card-body">
                    <h5><i class="fa-solid fa-user-plus me-2 text-primary"></i>Add Doctor</h5>
                    <form th:action="@{/doctors/add}" method="post" enctype="multipart/form-data" class="needs-validation" novalidate>

                        <div class="mb-3">
                            <label class="form-label required">License Number</label>
                            <input class="form-control" type="text" name="licenseNumber" placeholder="Enter License Number" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label required">Full Name</label>
                            <input class="form-control" id="fullNameInput" type="text" name="fullName" placeholder="Dr. " required>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Gender</label>
                                <select class="form-select" name="gender">
                                    <option value="">Select...</option>
                                    <option>Male</option><option>Female</option><option>Other</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Date of Birth</label>
                                <input class="form-control" type="date" name="dateOfBirth">
                            </div>
                        </div>

                        <div class="row g-3 mt-0">
                            <div class="col-md-6">
                                <label class="form-label">Age</label>
                                <input class="form-control" type="number" name="age" min="0">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label required">Phone</label>
                                <input class="form-control" type="text" name="phone" pattern="\d{10}" maxlength="10" required placeholder="10-digit number">
                            </div>
                        </div>

                        <div class="mt-3">
                            <label class="form-label required">Email</label>
                            <input class="form-control" type="email" name="email" pattern="^[^@\s]+@[^@\s]+\.com$" placeholder="doctor@hospital.com" required>
                        </div>

                        <div class="mt-3">
                            <label class="form-label">Specialization</label>
                            <select class="form-select" name="specialization">
                                <option th:each="spec : ${specializations}" th:value="${spec}" th:text="${spec}"></option>
                            </select>
                        </div>

                        <div class="mt-3">
                            <label class="form-label">Profile Photo</label>
                            <input class="form-control" type="file" name="photo" accept=".jpg,.jpeg,.png">
                        </div>

                        <div class="d-grid mt-3">
                            <button class="btn btn-primary"><i class="fa-solid fa-floppy-disk me-2"></i>Save Doctor</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Doctors Table -->
        <div class="col-lg-7">
            <div class="card">
                <div class="card-body">
                    <h5><i class="fa-solid fa-list me-2 text-primary"></i>Registered Doctors</h5>
                    <div class="table-responsive mt-3">
                        <table class="table">
                            <thead><tr><th>ID</th><th>Photo</th><th>License</th><th>Name</th><th>Spec.</th><th>Email</th><th>Phone</th><th></th></tr></thead>
                            <tbody>
                            <tr th:each="d : ${doctors}">
                                <td th:text="${d.id}">1</td>
                                <td>
                                    <img th:if="${d.photoPath}" th:src="@{${d.photoPath}}" class="thumb">
                                    <span th:if="${d.photoPath == null}" class="text-muted small">No Photo</span>
                                </td>
                                <td th:text="${d.licenseNumber}">LIC123</td>
                                <td th:text="${d.fullName}">Dr. Name</td>
                                <td th:text="${d.specialization}">Cardiology</td>
                                <td th:text="${d.email}">email</td>
                                <td th:text="${d.phone}">1234567890</td>
                                <td class="text-end">
                                    <a th:href="@{|/doctors/${d.id}|}" class="btn btn-sm btn-outline-primary"><i class="fa-regular fa-eye"></i></a>
                                    <a th:href="@{|/doctors/${d.id}/edit|}" class="btn btn-sm btn-secondary"><i class="fa-solid fa-pen"></i></a>
                                    <form th:action="@{|/doctors/${d.id}/delete|}" method="post" class="d-inline" onsubmit="return confirm('Delete this doctor?')">
                                        <button class="btn btn-sm btn-danger"><i class="fa-solid fa-trash"></i></button>
                                    </form>
                                </td>
                            </tr>
                            <tr th:if="${#lists.isEmpty(doctors)}">
                                <td colspan="8" class="text-center text-muted">No doctors yet.</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    (() => {
        const forms=document.querySelectorAll('.needs-validation');
        Array.from(forms).forEach(f=>{
            f.addEventListener('submit',e=>{
                if(!f.checkValidity()){e.preventDefault();e.stopPropagation();}
                f.classList.add('was-validated');
            },false);
        });
        const nameInput=document.getElementById("fullNameInput");
        if(nameInput){
            nameInput.addEventListener("focus",()=>{
                if(!nameInput.value.startsWith("Dr.")){
                    nameInput.value="Dr. "+nameInput.value;
                }
            });
        }
    })();
</script>
</body>
</html>
